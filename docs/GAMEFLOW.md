# 게임 흐름 기획(핵심)

1. 기본 약속
   1. 모든 단계에서, host와 user 둘 다 로그아웃되거나 연결이 끊어지더라도 다시 로그인하고, 연결하였을 때 이전과 똑같이 게임에 참여할 수 있도록 하여야만 한다.
      1. 로그아웃 후 재접속 시 이전의 팀 소속 정보와 점수가 유지되어야 한다. 유저의 고유 ID와 방 ID가 매핑되어 남아있어야 한다.
      2. 팀장이 게임 중간에 연결이 끊기면 다음 입장한 순번의 유저(혹은 랜덤의 유저)에게 팀장이 자동으로 넘어가도록 위임 로직을 설정한다.
   2. 게임을 하는 도중 휴대폰이 꺼지지 않도록 한다.
2. Room에서 Game 생성 단계

![항구뷰_게임시작전_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%ED%95%AD%EA%B5%AC%EB%B7%B0_%EA%B2%8C%EC%9E%84%EC%8B%9C%EC%9E%91%EC%A0%84_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

[web-pc 페이지] 게임을 시작하고 싶은 사람(host)이, web-pc 페이지에서 방 이름과 비밀번호 4자리를 입력하여 게임 방을 만든다. 이 때, 각각의 팀 이름(default : A팀, B팀)과 팀의 최대 인원수 (default : INF, 두 팀의 최대 인원수는 같음)를 host가 설정하는 form이 팀 생성 단계 이전에 나타나야 하며, 인터넷의 오류로 host가 로그아웃되더라도 다시 처음에 입력하였던 것과 같은 방 이름과 비밀번호 4자리로 재로그인하여 기존 게임 방(Radis)으로 들어갈 수 있어야 한다.

1. WAITING 상태

   ![항구뷰_초기화면_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%ED%95%AD%EA%B5%AC%EB%B7%B0_%EC%B4%88%EA%B8%B0%ED%99%94%EB%A9%B4_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   [web-pc 페이지]

   게임 방으로 들어간 후, 게임 방에서는 (게임 방으로) 들어올 수 있는 웹페이지 링크(링크를 가리키는 QR코드)와, 현재 들어온 유저가 누구이며 몇 명인지, 팀별로 표시되어야 하며 유저에 대한 정보는 유저가 정한 닉네임, 유저의 프로필 이미지가 나타나야 한다. 팀원 추가 및 삭제, 유저 프로필 변경, 팀장 변경의 game state에 변화가 생긴다면 실시간으로 업데이트되어야 한다. 팀장은 왕관 아이콘으로 별도로 표시하며, 팀장은 팀별로 서버에 처음 들어온 사람이 팀장이 된다. 모든 참가 인원이 준비완료 상태가 되면, 시작버튼이 생기고, 호스트가 누르면 TUTORIAL 상태로 넘어간다.

   [web-mobile 페이지]

   입장 단계 - QR 코드를 인식하거나, 링크를 통해 게임 방 페이지를 들어간다. 이 때 web-pc 페이지에 게임 방의 이름이 Google Login 전에 표시되어야 한다. Google Login 후, 만일 해당 서비스를 처음 이용하는 사람이라면 프로필 이미지와 닉네임, 팀을 설정한 뒤, 게임 방으로 입장한다. 이미 DB에 해당 유저의 정보가 있다면 그 정보를 이용한다. 각 팀에서 서버에 처음 들어온 유저라면 자동으로 팀장이 된다.

   대기 단계(다른 유저의 입장 대기) -  ‘준비 완료’ 버튼이 눌러지지 않았다면 언제든지 프로필 이미지와 닉네임을 수정할 수 있도록 한다. 팀장의 web-mobile 페이지에서는 팀장을 양도할 수 있는 버튼이 생기고, 이 버튼을 통해 팀장을 양도할 수 있도록 한다. 팀장 권한을 양도하는 즉시 버튼은 사라지며, 새로운 팀장에게 버튼이 생기도록 실시간으로 변경한다.
2. CINEMATIC 상태

   : 시각적, 촉각적 몰입도를 주어 게임 시작을 알리는 단계. (영상을 보여줌)

   [web-pc 페이지]

   화면에 배가 출항하는 약10초길이의 영상이 보여준 뒤, 자동으로 TUTORIAL 상태로 넘어간다.

   [web-mobile 페이지]

   진동 기능을 이용해, 휴대폰에서 CINEMATIC 상태일 때 진동(햅틱) 알림을 줘서 배가 출항하는 느낌을 받을 수 있도록 한다. *(iOS의 WebKit에서는 해당 기능 제외).*
3. TUTORIAL 상태

   ![선박뷰_튜토리얼_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%EC%84%A0%EB%B0%95%EB%B7%B0_%ED%8A%9C%ED%86%A0%EB%A6%AC%EC%96%BC_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   게임 시작 전, 튜토리얼 및 센서 확인 절차를 거친다. 게임 플레이 방식을 설명하고, 우리가 정한 역치 이상인지(즉, *카운트가 올라가는지*) 확인해서 만일 확인된다면, 확인되었다는 형태를 표시한다. (ex – 프로필 색이 변경됨) 이 시점부터, 2개팀의 화면이 분할되어 나타난다.

   [web-pc 페이지]

   출항 이후, 팀A,B의 화면이 중앙 세로선을 기준으로 나뉜다. 낚시배 선박 난간에 낚시대 및 장비가 있는 ‘선박뷰’를 배경으로 ‘센서 확인: 팀원별 프로필 아이콘(이미지+하단에 이름)’ 화면 → ‘튜토리얼’ 화면으로 진행된다. 각 팀이 모두 센서 확인이 완료되면 효과음이 생기고, 튜토리얼 화면으로 함께 전환된다.

   센서 확인 - “휴대폰을 흔들어 센서를 확인합니다. 아이폰은 권한을 허용해주세요.” 메세지를 띄운다. 각 유저가 모바일에서 shake 신호를 보낸 것을 서버에서 확인하면, 프로필 아이콘 원형 바깥이 초록색으로 바뀌어 센서가 작동하는지 확인할 수 있도록 한다.

   튜토리얼 -  “Casting 후 Hit이 발생하면, 휴대폰을 흔들어 게이지바를 채워서 물고기를 낚아주세요!” 같은 게임 방식이 설명된다.

   [web-mobile 페이지]

   web-mobile 페이지에서, shake 신호를 서버로 보낸다. 이 때부터 게임이 끝나기 전까지 휴대폰에는 현재 어떤 상태인지 표시하도록 한다. (예시 : 튜토리얼 상태입니다, 열심히 흔들어주세요! (PLAYING 상태 등)) 또한, 이 때부터 게임이 끝날 때까지 Shake 신호가 인식될 때, 화면의 background-color를 일시적으로 초록색으로 바꾼다.
4. CASTING 상태

   ![선박뷰_캐스팅대기_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%EC%84%A0%EB%B0%95%EB%B7%B0_%EC%BA%90%EC%8A%A4%ED%8C%85%EB%8C%80%EA%B8%B0_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   ![바다뷰_입질대기_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%EB%B0%94%EB%8B%A4%EB%B7%B0_%EC%9E%85%EC%A7%88%EB%8C%80%EA%B8%B0_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   : 팀 별 팀장이 낚시줄을 던지는 Casting을 진행 및 입질을 하며 PLAYING 이전 상태까지의 로직을 진행한다. 선박뷰(Casting전) → 바다뷰(Casting 낚시줄이 날아감) → 선박뷰(입질을 기다림, PLAYING 직전)

   “Casting 하세요”가 뜨고 5초 카운트 이후 팀장이 폰을 휘둘러 Casting을 하고(날아가는 그래픽 효과를 바다뷰에서 구현), 바다에 잠긴 뒤에는 선박뷰로 돌아와 입질을 기다린다. 낚시찌가 내려가면 “HIT” 효과가 뜨면서 PLAYING 상태로 전환된다.

   [web-pc 페이지]

   선박뷰(Casting전) - “Casting을 준비해주세요(휴대폰을 잡고 뒤에서 앞으로 스윙해주세요)” 메세지와 함께 5초 카운트 다운을 한다. 카운트 다운 직후 2초(변경 가능)간 팀장 유저를 통해 전달된 power 값을 이용해 날아가는 시작 효과를 넣는다. 이 때 Power 값은 가속도 센서의 Peak Value를 쓰고, 일반적인 shake와는 다른 로직으로 처리한다.

   바다뷰(Casting 낚시줄이 날아감) - PC 화면의 SVG 낚싯대가 뒤로 젖혀졌다가 앞으로 튕겨 나가는 **줌인(Zoom-in) + 모션 블러** 효과를 제공한다. 찌가 물에 닿으면 0.5초 후 선박뷰로 전환됨.

   선박뷰(입질을 기다림, PLAYING 직전) - 전환 이후 고정된 시간(5초) 후 찌가 내려가면서 PLAYING 상태로 전환됨.

   [web-mobile 페이지]

   팀 별 팀장의 페이지에 “Casting 하세요”라는 문구를 표출한다. 이외의 플레이어는 이전과 똑같이, 어떤 상태인지(Casting 상태)만을 표시하고, Shake 신호가 인식될 때, 화면의 background-color를 일시적으로 초록색으로 바꾼다.
5. PLAYING 상태

   ![바다뷰_낚시메인(핵심)_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%EB%B0%94%EB%8B%A4%EB%B7%B0_%EB%82%9A%EC%8B%9C%EB%A9%94%EC%9D%B8(%ED%95%B5%EC%8B%AC)_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   모든 팀원이 함께 휴대폰을 흔들어 카운트를 올리고, 실시간으로 물고기가 가까워지는 등의 event를 통해 둘 중 한 팀이 물고기를 낚을 때까지 게임을 진행한다.

   [web-pc 페이지]

   바다뷰에 낚시대 + 게이징바 + 물고기가 있는 화면이 보이면서 각 팀별 카운트 총합에 따라 낚싯대, 물고기가 이동한다.

   거리 게이지: `Start(100m)` --- `Ship(0m)` 프로그레스 바.

   SVG 낚싯대 텐션: 팀 합산 점수 증가 속도(Velocity)에 따라 낚싯대가 U자로 팽팽하게 휘어지는 SVG Path Morphing.

   물고기 이동: `Lerp(선형 보간)`를 사용하여 소켓 데이터가 끊겨서 들어와도 물고기는 부드럽게 헤엄치듯 이동.

   [web-mobile 페이지]

   모든 플레이어의 페이지에 “열심히 흔들어주세요!”라는 문구를 표출한다. Shake 신호가 인식될 때, 화면의 background-color를 일시적으로 초록색으로 바꾼다.
6. FINISHED

   ![항구뷰_게임종료_스케치.jpg](%EA%B2%8C%EC%9E%84%20%ED%9D%90%EB%A6%84%20%EA%B8%B0%ED%9A%8D(%ED%95%B5%EC%8B%AC)/%ED%95%AD%EA%B5%AC%EB%B7%B0_%EA%B2%8C%EC%9E%84%EC%A2%85%EB%A3%8C_%EC%8A%A4%EC%BC%80%EC%B9%98.jpg)

   게임이 끝나면 초기 항구 뷰에서 승리팀과 패배팀 각각의 정보, 각 팀원별 점수(Shake 횟수)를 보여주고, 저장하고 나가기 버튼을 통해서 게임 로그를 저장한다. 해당 게임의 정보는 Redis에서 PostgreSQL로 이동한다.

   [web-pc 페이지]

   항구뷰를 배경으로 리더보드를 띄워준다(서버로부터 받아온 게임 정보를 기반으로 승리팀, 팀 이름, 각 팀원별 닉네임 + 점수 보여줌)

   [web-mobile 페이지]
